import asyncio
import websockets
from websockets.exceptions import ConnectionClosedError
import time

prices = {
    'TRX/USDT': [
        0.094,
        0.094,
        0.096,
        0.096,
        0.092,
        0.092,
        0.092,
        0.092,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.090,
        0.096,
        0.097,
        0.097,
        0.098,
        0.098,
        0.099,
        0.102,
        0.105,
        0.105,
        0.106,
        0.107,
        0.108,
        0.110,
        0.112,
        0.112,
        0.113,
        0.120,
        0.120,
        0.120,
        0.120,
        0.118,
        0.118,
        0.118,
        0.118,
        0.115,
        0.113,
        0.113,
        0.115,
        0.115,
        0.115,
        0.115,
        0.110,
        0.110,
        0.103,
        0.103,
        0.103,
        0.101,
        0.101,
        0.101,
        0.097,
        0.097,
        0.095,
        0.095,
        0.095,
        0.092,
        0.092,
        0.092,
        0.092,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.091,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
        0.100,
    ],
    'AVAX/USDT': [
        124,
        124,
        123,
        123,
        122,
        122,
        121,
        121,
        120,
        120,
        119,
        119,
        118,
        118,
        117,
        124,
        125,
        125,
        126,
        126,
        126,
        126,
        126,
        127,
        127,
        127,
        127,
        128,
        130,
        130,
        130,
        130,
        130,
        130,
        130,
        130,
        133,
        133,
        133,
        133,
        133,
        133,
        133,
        133,
        133,
        136,
        136,
        136,
        136,
        136,
        140,
        140,
        140,
        140,
        140,
        140,
        140,
        140,
        141,
        142,
        144,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
        145,
    ]
}


async def send_price(websocket, path):
    while True:
        symbol = await websocket.recv()
        print(symbol)
        while True:
            try:
                price = prices[symbol].pop(0)
                await websocket.send(str(price))
                time.sleep(1)
            except ConnectionClosedError as e:
                print('reconnecting')
                break


start_server = websockets.serve(send_price, "localhost", 9000)

asyncio.get_event_loop().run_until_complete(start_server)
asyncio.get_event_loop().run_forever()
